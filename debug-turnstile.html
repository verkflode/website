<!DOCTYPE html>
<html>
<head>
    <title>Turnstile Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Turnstile Debug Test</h1>
    <div class="info">
        <strong>Current domain:</strong> <span id="domain"></span><br>
        <strong>Site key:</strong> 0x4AAAAAABvQQQ8dZiQYK5sR
    </div>
    
    <div id="status" class="status">Loading Turnstile...</div>
    
    <button id="testBtn" onclick="testInvisibleTurnstile()">Test Invisible Turnstile</button>
    
    <div id="result"></div>
    
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <script>
        document.getElementById('domain').textContent = window.location.hostname;
        
        function testInvisibleTurnstile() {
            document.getElementById('status').className = 'status info';
            document.getElementById('status').innerHTML = 'üîÑ Testing Invisible Turnstile...';
            
            if (typeof turnstile === 'undefined') {
                onTurnstileError('Turnstile script not loaded');
                return;
            }
            
            turnstile.execute('#testBtn', {
                sitekey: '0x4AAAAAABvQQQ8dZiQYK5sR',
                callback: onTurnstileSuccess,
                'error-callback': onTurnstileError
            });
        }
        
        function onTurnstileSuccess(token) {
            document.getElementById('status').className = 'status success';
            document.getElementById('status').innerHTML = '‚úÖ SUCCESS - Invisible Turnstile is working!';
            document.getElementById('result').innerHTML = `
                <div class="success">
                    <h3>‚úÖ Invisible Turnstile Working Perfectly!</h3>
                    <p><strong>Domain:</strong> ${window.location.hostname}</p>
                    <p><strong>Token received:</strong> ${token.substring(0, 30)}...</p>
                    <p><strong>Mode:</strong> Invisible (no user interaction needed for normal traffic)</p>
                    <p><strong>Status:</strong> This domain is properly configured in Cloudflare</p>
                </div>
            `;
        }
        
        function onTurnstileError(error) {
            document.getElementById('status').className = 'status error';
            document.getElementById('status').innerHTML = '‚ùå ERROR - Invisible Turnstile failed';
            document.getElementById('result').innerHTML = `
                <div class="error">
                    <h3>‚ùå Invisible Turnstile Configuration Error</h3>
                    <p><strong>Domain:</strong> ${window.location.hostname}</p>
                    <p><strong>Error:</strong> ${error}</p>
                    <p><strong>Cause:</strong> This domain is NOT in your Turnstile allowed domains list</p>
                    <h4>To Fix:</h4>
                    <ol>
                        <li>Go to <a href="https://dash.cloudflare.com" target="_blank">Cloudflare Dashboard</a></li>
                        <li>Navigate to Turnstile</li>
                        <li>Find site key: 0x4AAAAAABvQQQ8dZiQYK5sR</li>
                        <li>Add "${window.location.hostname}" to the domains list</li>
                        <li>Save and refresh this page</li>
                    </ol>
                </div>
            `;
        }
        
        // Check if Turnstile script loaded
        setTimeout(() => {
            if (typeof turnstile === 'undefined') {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').innerHTML = '‚ùå SCRIPT LOAD FAILED';
                document.getElementById('result').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Turnstile Script Failed to Load</h3>
                        <p>The Cloudflare Turnstile script didn't load properly.</p>
                        <p>Check browser console for network errors.</p>
                    </div>
                `;
            }
        }, 5000);
        
        // Monitor for 401 errors in console
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            return originalFetch.apply(this, args).then(response => {
                if (response.status === 401) {
                    document.getElementById('result').innerHTML += `
                        <div class="error">
                            <h4>üö® 401 Unauthorized Detected</h4>
                            <p>Turnstile API returned 401 - domain not configured!</p>
                        </div>
                    `;
                }
                return response;
            });
        };
    </script>
</body>
</html>